from aiogram import Router, F
from aiogram.filters import CommandStart, Command
from aiogram.types import Message, CallbackQuery

from database import UserDB
from keyboards import main_menu_keyboard, diet_keyboard
from models import User

# –í–û–¢ –≠–¢–ê –°–¢–†–û–ö–ê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –í –ö–ê–ñ–î–û–ú –§–ê–ô–õ–ï –•–≠–ù–î–õ–ï–†–ê
router = Router()

WELCOME_TEXT = """
üçΩÔ∏è <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ WhatToEat!</b>

–Ø —Ä–µ—à—É –≤–µ—á–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É ¬´–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?¬ª ü§î

<b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>
1Ô∏è‚É£ –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –µ—Å—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ
2Ô∏è‚É£ –Ø –ø—Ä–µ–¥–ª–æ–∂—É —Ä–µ—Ü–µ–ø—Ç—ã –∏–∑ —Ç–≤–æ–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
3Ô∏è‚É£ –°–æ—Å—Ç–∞–≤–ª—é —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ
4Ô∏è‚É£ –ü–æ—Å—á–∏—Ç–∞—é –∫–∞–ª–æ—Ä–∏–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å

<b>–°–ø–æ—Å–æ–±—ã –≤–≤–æ–¥–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:</b>
üìù <b>–¢–µ–∫—Å—Ç–æ–º</b> ‚Äî ¬´–∫—É—Ä–∏—Ü–∞, —Ä–∏—Å, –ª—É–∫, —Å–º–µ—Ç–∞–Ω–∞¬ª
üé§ <b>–ì–æ–ª–æ—Å–æ–º</b> ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–∏–∫—Ç—É–π —Å–ø–∏—Å–æ–∫
üì∏ <b>–§–æ—Ç–æ</b> ‚Äî —Å—Ñ–æ—Ç–∫–∞–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ (–±–µ—Ç–∞)

<b>–ú–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</b>
üç≥ –ü–æ–¥–±–æ—Ä —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º
üìä –ü–æ–¥—Å—á—ë—Ç –∫–∞–ª–æ—Ä–∏–π –∏ –ë–ñ–£
üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ —Å —Ü–µ–Ω–∞–º–∏
üóì –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é ‚≠êÔ∏è
ü•ó –£—á—ë—Ç –¥–∏–µ—Ç –∏ –∞–ª–ª–µ—Ä–≥–∏–π ‚≠êÔ∏è

–ñ–º–∏ <b>¬´üç≥ –ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?¬ª</b> –∏ –Ω–∞—á–∏–Ω–∞–π!
"""

HELP_TEXT = """
üìñ <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ WhatToEat</b>

<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/start ‚Äî –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
/help ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/profile ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
/premium ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ

<b>–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã:</b>
üìù –¢–µ–∫—Å—Ç–æ–º: ¬´–∫—É—Ä–∏—Ü–∞, –∫–∞—Ä—Ç–æ—à–∫–∞, –ª—É–∫, —Å–º–µ—Ç–∞–Ω–∞¬ª
üé§ –ì–æ–ª–æ—Å–æ–≤—ã–º: –∑–∞–∂–º–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –ø–µ—Ä–µ—á–∏—Å–ª–∏
üì∏ –§–æ—Ç–æ: —Å—Ñ–æ—Ç–∫–∞–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞

<b>Free:</b> 3 —Ä–µ—Ü–µ–ø—Ç–∞ –≤ –¥–µ–Ω—å
<b>Premium (490‚ÇΩ/–º–µ—Å):</b> –±–µ–∑–ª–∏–º–∏—Ç + –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è + —É—á—ë—Ç –¥–∏–µ—Ç
"""


@router.message(CommandStart())
async def cmd_start(message: Message, db_user: User):
    await message.answer(
        WELCOME_TEXT,
        parse_mode="HTML",
        reply_markup=main_menu_keyboard()
    )

    if not db_user.diet_type:
        await message.answer(
            "üéØ –î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞—Å—Ç—Ä–æ–π –ø—Ä–æ—Ñ–∏–ª—å!\n"
            "–ö–∞–∫–æ–π —Ç–∏–ø –ø–∏—Ç–∞–Ω–∏—è —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç?",
            reply_markup=diet_keyboard()
        )


@router.message(Command("help"))
async def cmd_help(message: Message, db_user: User):
    await message.answer(HELP_TEXT, parse_mode="HTML")


@router.callback_query(F.data == "back_to_menu")
async def back_to_menu(callback: CallbackQuery, db_user: User):
    await callback.message.answer(
        "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
        reply_markup=main_menu_keyboard()
    )
    await callback.answer()
